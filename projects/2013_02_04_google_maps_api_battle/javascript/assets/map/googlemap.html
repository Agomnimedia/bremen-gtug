<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
html {
	height: 100%
}

body {
	height: 100%;
	margin: 0;
	padding: 0
}

#map_canvas {
	height: 100%
}
</style>
<script type="text/javascript"
	src="http://maps.google.com/maps/api/js?sensor=true">
	
</script>
<script type="text/javascript">
	/**
	 * Reference to the GoogleMaps element.
	 */
	var map;

	/**
	 * stores the marker for the current geolocation of the user.
	 */
	var currentPositionMarker;

	/**
	 * id of the geolocation watching process, for aborting on page unload.
	 */
	var watchGeolocationId;

	function initialize() {
		var mapOptions = {
			center : new google.maps.LatLng(53.075858, 8.80772),
			zoom : 17,
			mapTypeId : google.maps.MapTypeId.HYBRID, //TERRAIN, HYBRID, ROADMAP, SATELLITE
			panControl : false,
			zoomControl : false,
			mapTypeControl : false,
			scaleControl : false,
			streetViewControl : false,
			overviewMapControl : false
		};
		map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
	}

	function showMarker() {
		console.debug("showMarker()");
		// TODO
	}

	function hideMarker() {
		console.debug("hideMarker()");
		// TODO
	}

	function showOverlays() {
		console.debug("showOverlays()");
		// TODO
	}

	function hideOverlays() {
		console.debug("hideOverlays()");
		// TODO
	}

	function showPosition() {
		console.debug("showPosition()");
		watchGeolocationId = navigator.geolocation.watchPosition(
				function(position) {
					console.debug("geolocation details: " + JSON.stringify(position.coords));
					updateGeoPosition(position.coords.latitude,
							position.coords.longitude, position.coords.accuracy);
				}, function(error) {
					console.error("Thera are no current geoposition, because '"
							+ error.message + "', Code " + error.code);
				}, {
					maximumAge : 3000,
					timeout : 5000,
					enableHighAccuracy : true
				});
	}

	function hidePosition() {
		console.debug("hidePosition()");
		if (watchGeolocationId) {
			navigator.geolocation.clearWatch(watchGeolocationId);
		}
	}

	function showRoute() {
		console.debug("showRoute()");
		// TODO
	}

	function hideRoute() {
		console.debug("hideRoute()");
		// TODO
	}

	function setMapType(mapType) {
		console.debug("setMapType(" + mapType + ")");
		if (mapType == "NONE") {
			map.setMapTypeId();
		} else {
			map.setMapTypeId(google.maps.MapTypeId[mapType]);
		}
	}

	/**
	 * show a circle on the current users geo location.
	 * 
	 * @param {Number}
	 *          latitude the latitude of the geo location.
	 * @param {Number}
	 *          longitude the longitude of the geo location.
	 * @param {Number}
	 *          accuracy of the geo location.
	 */
	var markGeoPosition = function(latitude, longitude, accuracy) {
		if (currentPositionMarker) {
			currentPositionMarker.setMap(null);
		}
		var markerLatlng = new google.maps.LatLng(latitude, longitude);
		currentPositionMarker = new google.maps.Circle({
			clickable : false,
			center : markerLatlng,
			map : map,
			radius : accuracy,
			fillColor : '#0000ff',
			fillOpacity : '0.08',
			strokeColor : '#0000ff',
			strokeOpacity : '0.5'
		});
	};

	/**
	 * update the circle position and size on the current users geo location.
	 * 
	 * @param {Number}
	 *          latitude the latitude of the geo location.
	 * @param {Number}
	 *          longitude the longitude of the geo location.
	 * @param {Number}
	 *          accuracy of the geo location.
	 */
	var updateGeoPosition = function(latitude, longitude, accuracy) {
		if (!currentPositionMarker) {
			markGeoPosition(latitude, longitude, accuracy);
			return;
		}
		var markerLatlng = new google.maps.LatLng(latitude, longitude);
		currentPositionMarker.setCenter(markerLatlng);
		currentPositionMarker.setRadius(accuracy);
	}
</script>
</head>
<body onload="initialize()">
	<div id="map_canvas" style="width: 100%; height: 100%"></div>
</body>
</html>