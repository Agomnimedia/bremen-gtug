<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="styles.css" />
<script type="text/javascript"
	src="http://maps.google.com/maps/api/js?sensor=true">
	
</script>
<script type="text/javascript">
	/**
	 * Reference to the GoogleMaps element.
	 */
	var map;

	/**
	 * stores the marker for the current geolocation of the user.
	 */
	var currentPositionMarker = new google.maps.Circle({
		clickable : false,
		radius : 0.2,
		strokeColor : '#0066FF',
		strokeOpacity : 1,
		strokeWeight : 10
	});

	/**
	 * stores the circle around the marker for the current geolocation of the user.
	 */
	var currentPositionMarkerCircle = new google.maps.Circle({
		clickable : false,
		fillColor : '#0099FF',
		fillOpacity : 0.15,
		strokeColor : '#0099FF',
		strokeOpacity : 0.5,
		strokeWeight : 1
	});

	/**
	 * Control button to jump to the current geo location.
	 */
	var controlUI;

	/**
	 * id of the geolocation watching process, for aborting on page unload.
	 */
	var watchGeolocationId;

	function initialize() {
		var mapOptions = {
			center : new google.maps.LatLng(53.075858, 8.80772),
			zoom : 17,
			mapTypeId : google.maps.MapTypeId.HYBRID, //TERRAIN, HYBRID, ROADMAP, SATELLITE
			panControl : false,
			zoomControl : false,
			mapTypeControl : false,
			scaleControl : false,
			streetViewControl : false,
			overviewMapControl : false
		};
		map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

		// Setup the click event listener on the control UI.
		controlUI = document.getElementById("controlUI");
		google.maps.event.addDomListener(controlUI, 'click', function() {
			map.setCenter(currentPositionMarker.getCenter());
		});

		// We don't really need to set an index value here, but
		// this would be how you do it. Note that we set this
		// value as a property of the DIV itself.
		document.getElementById("controlDiv").index = 1;

		//Add the control to the map at a designated control position
		//by pushing it on the position's array. This code will
		//implicitly add the control to the DOM, through the Map
		//object. You should not attach the control manually.
		map.controls[google.maps.ControlPosition.TOP_RIGHT].push(document
				.getElementById("controlDiv"));
	}

	function showMarker() {
		console.debug("showMarker()");
		// TODO
	}

	function hideMarker() {
		console.debug("hideMarker()");
		// TODO
	}

	function showOverlays() {
		console.debug("showOverlays()");
		// TODO
	}

	function hideOverlays() {
		console.debug("hideOverlays()");
		// TODO
	}

	function showPosition() {
		console.debug("showPosition()");
		watchGeolocationId = navigator.geolocation.watchPosition(
				function(position) {
					console.debug("geolocation details: "
							+ JSON.stringify(position.coords));
					updateGeoPosition(position.coords.latitude,
							position.coords.longitude, position.coords.accuracy);
				}, function(error) {
					console.error("There are no current geoposition, because '"
							+ error.message + "', Code " + error.code);
				}, {
					maximumAge : 3000,
					timeout : 5000,
					enableHighAccuracy : true
				});
	}

	function hidePosition() {
		console.debug("hidePosition()");
		if (watchGeolocationId) {
			navigator.geolocation.clearWatch(watchGeolocationId);
		}
		controlUI.style.display = 'none';
		currentPositionMarker.setMap(null);
		currentPositionMarkerCircle.setMap(null);
	}

	function showRoute() {
		console.debug("showRoute()");
		// TODO
	}

	function hideRoute() {
		console.debug("hideRoute()");
		// TODO
	}

	function setMapType(mapType) {
		console.debug("setMapType(" + mapType + ")");
		if (mapType == "NONE") {
			map.setMapTypeId();
		} else {
			map.setMapTypeId(google.maps.MapTypeId[mapType]);
		}
	}

	/**
	 * update the circle position and size on the current users geo location.
	 * 
	 * @param {Number}
	 *          latitude the latitude of the geo location.
	 * @param {Number}
	 *          longitude the longitude of the geo location.
	 * @param {Number}
	 *          accuracy of the geo location.
	 */
	var updateGeoPosition = function(latitude, longitude, accuracy) {
		currentPositionMarker.setMap(null);
		currentPositionMarkerCircle.setMap(null);
		var markerLatlng = new google.maps.LatLng(latitude, longitude);
		currentPositionMarker.setCenter(markerLatlng);
		currentPositionMarkerCircle.setCenter(markerLatlng);
		currentPositionMarkerCircle.setRadius(accuracy);
		currentPositionMarker.setMap(map);
		currentPositionMarkerCircle.setMap(map);
		controlUI.style.display = 'block';
	}
</script>
</head>
<body onload="initialize()">
	<div id="map_canvas"></div>

	<div style="display: none;">
		<!-- HTML elements for using during JavaScript execution, to reduce the costs of creating elements programmatically. -->

		<div id="controlDiv">
			<div id="controlUI">
				<div class="mylocation">&nbsp;</div>
			</div>
		</div>

	</div>
</body>
</html>